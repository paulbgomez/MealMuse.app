name: Code Quality Checks and Tests for MealMuse
on:
  pull_request:
  push:
    branches:
      - main
jobs:
  code_quality_checks_and_tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛍️🛒
        uses: actions/checkout@v2
      - name: Setup JDK 🌟
        uses: actions/setup-java@v2
        with:
          java-version: 11
          distribution: 'temurin'
      - name: Install ktlint 🔧
        run: |
          curl -sSLO https://github.com/pinterest/ktlint/releases/download/0.42.1/ktlint && chmod a+x ktlint && sudo mv ktlint /usr/local/bin/
      - name: Run ktlint 🚦
        run: ktlint -F "app/**/*.kt"
      - name: Setup emulator 📱
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 30
          target: default
          arch: x86_64
          profile: pixel
          heap-size: 2048
          cores: 2
          sdcard-path-or-size: 512M
          script: |
            # start the emulator and wait for it to finish booting
            emulator @default -no-window -no-audio -no-boot-anim -no-accel -gpu off -verbose -engine classic &
            android-wait-for-emulator
          sdk-path: /opt/android/sdk
          jdk-path: /usr/lib/jvm/java-11-openjdk-amd64
          - run: adb devices
      - name: Build and test app 🚀
        run: |
          ./gradlew assembleDebug testDebug
      - name: Report test results 📊
        uses: mikepenz/action-junit-report@v2
        with:
          report_paths: '**/test-results/**/*.xml'
      - name: Display success message 🎉
        if: ${{ job.status == 'success' }}
        run: echo "🎉 Congratulations, ${{ github.actor }}! All checks passed. 🚀"
      - name: Display failure message 💥
        if: ${{ job.status != 'success' }}
        run: echo "💥 Sorry, ${{ github.actor }}. There were issues with your code. 😞"